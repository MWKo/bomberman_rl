from settings import ROWS, COLS
import events as e

ACTIONS = ['UP', 'RIGHT', 'DOWN', 'LEFT', 'WAIT', 'BOMB']

# OLD FEATURES
# FEAT_WALLS = 0
# FEAT_CRATES = 1
# FEAT_COINS = 2
# FEAT_BOMBS = 3
# FEAT_OTHERS = 4
# 
# FEATURE_SHAPE_OLD = (5, 2 * ROWS - 3, 2 * COLS - 3)
# FEATURE_SIZE_OLD = FEATURE_SHAPE_OLD[0] * FEATURE_SHAPE_OLD[1] * FEATURE_SHAPE_OLD[2]


COIN_POS_FLENGTH = 5
CRATE_POS_FLENGTH = 5
OTHER_POS_FLENGTH = 5
LIVE_SAVING_FLENGTH = len(ACTIONS)
DEADLY_FLENGTH = len(ACTIONS)
BOMB_SURVIVABLE_FLENGTH = 1
BOMB_CRATE_IN_RANGE_FLENGTH = 1
BOMB_OTHERS_IN_RANGE_FLENGTH = 1

COIN_POS_FSTART = 1
COIN_POS_FEND = COIN_POS_FSTART + COIN_POS_FLENGTH

CRATE_POS_FSTART = COIN_POS_FEND
CRATE_POS_FEND = CRATE_POS_FSTART + CRATE_POS_FLENGTH

OTHER_POS_FSTART = CRATE_POS_FEND
OTHER_POS_FEND = OTHER_POS_FSTART + OTHER_POS_FLENGTH

LIVE_SAVING_FSTART = OTHER_POS_FEND
LIVE_SAVING_FEND = LIVE_SAVING_FSTART + LIVE_SAVING_FLENGTH

DEADLY_FSTART = LIVE_SAVING_FEND
DEADLY_FEND = DEADLY_FSTART + DEADLY_FLENGTH

BOMB_SURVIVABLE_FSTART = DEADLY_FEND
BOMB_SURVIVABLE_FEND = BOMB_SURVIVABLE_FSTART + BOMB_SURVIVABLE_FLENGTH

BOMB_CRATE_IN_RANGE_FSTART = BOMB_SURVIVABLE_FEND
BOMB_CRATE_IN_RANGE_FEND = BOMB_CRATE_IN_RANGE_FSTART + BOMB_CRATE_IN_RANGE_FLENGTH

BOMB_OTHERS_IN_RANGE_FSTART = BOMB_CRATE_IN_RANGE_FEND
BOMB_OTHERS_IN_RANGE_FEND = BOMB_OTHERS_IN_RANGE_FSTART + BOMB_OTHERS_IN_RANGE_FLENGTH

FEATURE_SIZE = BOMB_OTHERS_IN_RANGE_FEND

# Events
UNNECESSARY_WAITING = "UNNECESSARY_WAITING"
DEADLY_MOVE_CHOOSEN = "DEADLY_MOVE_CHOOSEN"
DEADLY_MOVE_AVOIDED = "DEADLY_MOVE_AVOIDED"
LIVE_SAVING_MOVE_CHOOSEN = "LIVE_SAVING_MOVE_CHOOSEN"
LIVE_SAVING_MOVE_AVOIDED = "LIVE_SAVING_MOVE_AVOIDED"
UNSURVIVABLE_BOMB_CHOOSEN = "UNSURVIVABLE_BOMB_CHOOSEN"
SURVIVABLE_BOMB_CHOOSEN = "SURVIVABLE_BOMB_CHOOSEN"
USEFULL_BOMB = "USEFULL_BOMB"
USELESS_BOMB = "USELESS_BOMB"
COIN_MOVE_CHOOSEN = "COIN_MOVE_CHOOSEN"
COIN_MOVE_AVOIDED = "COIN_MOVE_AVOIDED"
CRATE_MOVE_CHOOSEN = "CRATE_MOVE_CHOOSEN"
CRATE_MOVE_AVOIDED = "CRATE_MOVE_AVOIDED"


DEFAULT_CONFIG = {
    'model_filename': "model0.pt",
    'override_model': True,
    'exploration': {
        'epsilon': 0.1,
        'action_probabilities': [.2, .2, .2, .2, .1, .1]
    },
    'learning_rate': 0.002,
    'gamma': 0.75,
    'batch_size': 50,
    'n_training_per_batch': 25,
    'per': {
        'error_clip': 3,
        'error_offset': 0.001,
        'priority_scale': 0.6,
        'b': 0.4
    },
    'rewards': {
        e.COIN_COLLECTED: 1,
        e.KILLED_OPPONENT: 5,
        e.CRATE_DESTROYED: 0.3,
        DEADLY_MOVE_CHOOSEN: -3,
        DEADLY_MOVE_AVOIDED: 0.2,
        LIVE_SAVING_MOVE_CHOOSEN: 0.2,
        LIVE_SAVING_MOVE_AVOIDED: -3,
        UNSURVIVABLE_BOMB_CHOOSEN: -3,
        USEFULL_BOMB: 0.5,
        USELESS_BOMB: -1,
        COIN_MOVE_CHOOSEN: 0.5,
        COIN_MOVE_AVOIDED: -0.5,
        CRATE_MOVE_CHOOSEN: 0.3,
        CRATE_MOVE_AVOIDED: -0.3,
        UNNECESSARY_WAITING: -1,
        
        e.KILLED_SELF: -5,
    }
}